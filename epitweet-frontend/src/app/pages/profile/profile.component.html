<div class="profile-container">
    <!-- Left Sidebar (same as home) -->
    <div class="left-sidebar">
      <div class="logo">
        <img src="assets/images/tiny-twitter-logo.png" alt="Logo" class="logo-icon">
        <span class="logo-text">TinyTwitter</span>
      </div>
      
      <nav class="main-nav">
        <a routerLink="/home" class="nav-link">
          <mat-icon>home</mat-icon>
          <span>Accueil</span>
        </a>
        <a [routerLink]="['/profile', loggedUser?.userTag || '']" class="nav-link" [class.active]="targetUser === loggedUser">
          <mat-icon>person</mat-icon>
          <span>Profile</span>
        </a>
        <button class="post-creation-button">
          <mat-icon>edit</mat-icon>
          <span>Poster</span>
        </button>
      </nav>
      
      <div class="user-profile">
        <img [src]="loggedUser?.avatarUrl" alt="Profile" class="profile-pic">
        <div class="user-info">
          <span class="userName">{{ loggedUser?.userName }}</span>
          <span class="userTag">&#64;{{ loggedUser?.userTag }}</span>
        </div>
      </div>
    </div>
    
    <!-- Loading state -->
    <div *ngIf="isLoading" class="loading">
      Loading profile...
    </div>

    <!-- Error state -->
    <div *ngIf="userError" class="error-message">
      {{ userError }}
    </div>

    <!-- Content -->
    <div *ngIf="!isLoading && !userError">
      <!-- Profile Content -->
      <div class="profile-content">
        <div class="profile-header">
          <div class="profile-nav">
            <button mat-icon-button (click)="goBack()">
              <mat-icon>arrow_back</mat-icon>
            </button>
            <h1>Profile</h1>
          </div>
          <div class="profile-banner">
            <img [src]="targetUser?.bannerUrl" alt="Profile Banner">
          </div>
          <div class="profile-info">
            <img [src]="targetUser?.avatarUrl" alt="Profile" class="profile-picture">
            <button class="edit-profile-button" [class.hide]="targetUser !== loggedUser" (click)="openPopup()">Modifier le profil</button>
            <app-profile-update *ngIf="isPopupOpen" [userTag]="loggedUser?.userTag || ''" (close)="closePopup()"></app-profile-update>
          </div>

          <div class="profile-details">
            <h2>{{ targetUser?.userName }}</h2>
            <span class="userTag">&#64;{{ targetUser?.userTag }}</span>
            <p class="bio">{{ targetUser?.bio }}</p>
            
            <div class="stats">
              <span><strong>{{ targetUser?.followingCount }}</strong> abonnements</span>
              <span><strong>{{ targetUser?.followersCount }}</strong> abonnés</span>
            </div>
            
            <div class="tabs">
              <button 
                class="tab" 
                [class.active]="activeTab === 'posts'"
                (click)="setActiveTab('posts')">
                Posts
              </button>
              <button 
                class="tab"
                [class.active]="activeTab === 'replies'"
                (click)="setActiveTab('replies')">
                Réponses
              </button>
              <button class="tab">Médias</button>
              <button class="tab">J'aime</button>
            </div>
          </div>
        </div>
        
        <div class="profile-posts">
          <div *ngIf="postError" class="error-message">
            {{ postError }}
          </div>
          <div *ngIf="activeTab === 'posts' && !isLoading && !postError">
            <div *ngFor="let post of posts" class="post" [routerLink]="['/post', post._id]">
              <div class="post-header">
                <img [src]="targetUser?.avatarUrl || 'assets/images/default-profile.png'" class="post-profile-pic">
                <div class="post-user">
                  <span class="userName">{{ targetUser?.userName }}</span>
                  <span class="userTag">&#64;{{ targetUser?.userTag }}</span>
                  <span class="post-time">· {{ formatPostDate(post.createdAt) }}</span>
                </div>
                <!-- Three-dot menu -->
                <div *ngIf="targetUser === loggedUser" class="post-options">
                  <button mat-icon-button (click)="toggleDropdown(post._id, $event)">
                    <mat-icon>more_horiz</mat-icon>
                  </button>
                  <div *ngIf="dropdownOpen === post._id" class="dropdown-menu">
                    <button (click)="onDeletePost(post._id, $event)">Delete</button>
                  </div>
                </div>
              </div>
              <div class="post-content">{{post.content}}</div>
              <div class="post-actions">
                <button (click)="onLikeClick($event)"><mat-icon>favorite_border</mat-icon> {{ post.likes || 0 }}</button>
                <button><mat-icon>chat_bubble_outline</mat-icon> {{ post.comments || 0 }}</button>
              </div>
            </div>
            <div *ngIf="posts.length === 0" class="no-posts">
              No posts yet
            </div>
          </div>
          <div *ngIf="activeTab === 'replies' && !isLoading && !postError">
            <div *ngFor="let reply of replies" class="post">
              <div class="post-header">
                <img [src]="targetUser?.avatarUrl || 'assets/images/default-profile.png'" class="post-profile-pic">
                <div class="post-user">
                  <span class="userName">{{ targetUser?.userName }}</span>
                  <span class="userTag">&#64;{{ targetUser?.userTag }}</span>
                  <span class="post-time">· {{ formatPostDate(reply.createdAt) }}</span>
                </div>
              </div>
              <div class="post-content" [routerLink]="['/post', reply._id]">
                {{ reply.content }}
              </div>
              <div class="post-actions">
                <button><mat-icon>favorite_border</mat-icon> {{ reply.likes || 0 }}</button>
                <button [routerLink]="['/post', reply._id]"><mat-icon>chat_bubble_outline</mat-icon> {{ reply.comments || 0 }}</button>
              </div>
            </div>
            <div *ngIf="replies.length === 0" class="no-posts">
              No replies yet
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Sidebar (same as home) -->
    <div class="right-sidebar">
      <div class="search-bar">
        <mat-form-field appearance="outline">
          <input 
            matInput 
            placeholder="Rechercher"
            #searchInput
            (keyup.enter)="search(searchInput.value)">
        </mat-form-field>
      </div>
      
      <div class="trends">
      </div>
    </div>
</div>